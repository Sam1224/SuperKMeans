# Benchmark suite for SuperKMeans

# Common benchmark dependencies
set(BENCH_COMMON_LIBS
    ${BLAS_LINK_LIBRARIES}
    faiss
)

if (FFTW_FOUND)
    message(STATUS "Linking FFTW: ${FFTW_FLOAT_THREADS_LIB}")
    list(APPEND BENCH_COMMON_LIBS ${FFTW_FLOAT_LIB} ${FFTW_FLOAT_THREADS_LIB})
endif()

# Main benchmark: KMeans performance with synthetic data (vs FAISS)
add_executable(bench_kmeans.out bench_kmeans.cpp)
target_link_libraries(bench_kmeans.out PRIVATE ${BENCH_COMMON_LIBS})

# Real datasets benchmark (requires dataset files generated by bench_gen.py)
add_executable(bench_real_datasets.out bench_real_datasets.cpp)
target_link_libraries(bench_real_datasets.out PRIVATE ${BENCH_COMMON_LIBS})

# SuperKMeans benchmark on real datasets with recall computation
add_executable(end_to_end_superkmeans.out end_to_end_superkmeans.cpp)
target_link_libraries(end_to_end_superkmeans.out PRIVATE ${BENCH_COMMON_LIBS})

# FAISS benchmark on real datasets with recall computation
add_executable(end_to_end_faiss.out end_to_end_faiss.cpp)
target_link_libraries(end_to_end_faiss.out PRIVATE faiss ${BENCH_COMMON_LIBS})

# Early termination benchmarks
add_executable(early_termination_superkmeans.out early_termination_superkmeans.cpp)
target_link_libraries(early_termination_superkmeans.out PRIVATE ${BENCH_COMMON_LIBS})

add_executable(early_termination_faiss.out early_termination_faiss.cpp)
target_link_libraries(early_termination_faiss.out PRIVATE faiss ${BENCH_COMMON_LIBS})

# Sampling benchmark
add_executable(sampling_superkmeans.out sampling_superkmeans.cpp)
target_link_libraries(sampling_superkmeans.out PRIVATE ${BENCH_COMMON_LIBS})

# Pareto benchmark (grid search)
add_executable(pareto_superkmeans.out pareto_superkmeans.cpp)
target_link_libraries(pareto_superkmeans.out PRIVATE ${BENCH_COMMON_LIBS})

# Ad-hoc benchmark (verbose mode, no CSV output)
add_executable(ad_hoc_superkmeans.out ad_hoc_superkmeans.cpp)
target_link_libraries(ad_hoc_superkmeans.out PRIVATE ${BENCH_COMMON_LIBS})

# Microbenchmark for InitPositionsArray SIMD optimization
add_executable(microbenchmark_init_positions_array.out microbenchmark_init_positions_array.cpp)
target_link_libraries(microbenchmark_init_positions_array.out PRIVATE ${BENCH_COMMON_LIBS})

# Microbenchmark for FlipSign SIMD optimization
add_executable(microbenchmark_flip_sign.out microbenchmark_flip_sign.cpp)
target_link_libraries(microbenchmark_flip_sign.out PRIVATE ${BENCH_COMMON_LIBS})

# Microbenchmark for Horizontal L2 distance kernels
add_executable(microbenchmark_horizontal_kernels.out microbenchmark_horizontal_kernels.cpp)
target_link_libraries(microbenchmark_horizontal_kernels.out PRIVATE ${BENCH_COMMON_LIBS})
